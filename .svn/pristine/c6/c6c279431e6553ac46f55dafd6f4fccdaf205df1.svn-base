package com.dihuo.twodfire.retail.activity.goodsmanager;

import java.io.Serializable;

import com.dihuo.twodfire.retail.R;
import com.dihuo.twodfire.retail.data.CategoryVo;
import com.dihuo.twodfire.retail.global.Constants;
import com.dohuo.twofire.retail.network.AsyncHttpPost;
import com.dohuo.twofire.retail.network.RequestParameter;
import com.dohuo.twofire.retail.network.RequestResultCallback;

import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.CompoundButton.OnCheckedChangeListener;
import android.widget.EditText;
import android.widget.TextView;

public class GoodsSortDetailActivity extends GoodsManagerBaseActivity implements
		OnClickListener {
	
	private Category category;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_sort_detail);
		category = (Category) getIntent().getSerializableExtra("category");
		setEditTextContent(R.id.name, "商品分类名称", category.name, "");
		setEditTextContent(R.id.code, "商品分类编码", category.original.getId(), "");
		setCheckBoxContent(R.id.hasUp, "此分类有上级", category.original.hasParent());
		setSpinerConetent(R.id.shangji, "上级分类", category.parentName);
		
		setTitleText(category.name);
		
		findViewById(R.id.title_left).setOnClickListener(this);
		findViewById(R.id.title_right).setOnClickListener(this);
	}

	@Override
	public void onClick(View v) {
		switch (v.getId()) {
		case R.id.title_left:
			
			break;
		case R.id.title_right:
			save();
			break;

		default:
			break;
		}
	}
	
	
	private void save() {
		category.original.setName(((TextView)findViewById(R.id.name).findViewById(R.id.main)).getText().toString());
		category.original.setCode(((TextView)findViewById(R.id.code).findViewById(R.id.main)).getText().toString());
		RequestParameter params = new RequestParameter(true);
		params.setParam("category",category.original);
		params.setParam("operateType","edit");
		params.setUrl(Constants.BASE_URL + "category/save");
		
		new	AsyncHttpPost(params, new RequestResultCallback() {
			
			@Override
			public void onSuccess(String str) {
				System.out.println(str);
			}
			
			@Override
			public void onFail(Exception e) {
				e.printStackTrace();
			}
		}).execute();
	}

	private void setCheckBoxContent(int id, String label, boolean b) {
		View layout = findViewById(id);
		TextView labelText = (TextView) layout.findViewById(R.id.check_title);
		labelText.setText(label);
		((CheckBox)findViewById(R.id.checkbox)).setOnCheckedChangeListener(new OnCheckedChangeListener() {
			
			@Override
			public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
				switchToEditMode();
			}
		});
	}

	private void setSpinerConetent(int tongbu, String label, String value) {
		View layout = findViewById(tongbu);
		TextView tongbuLable = (TextView) layout.findViewById(R.id.main);
		tongbuLable.setText(label);
		TextView tongbuValue = (TextView) layout.findViewById(R.id.secend);
		tongbuValue.setText(value);
	}

	private void setEditTextContent(int id, String lable, String content,
			String hint) {
		View layout = findViewById(id);
		TextView lableView = (TextView) layout.findViewById(R.id.main);
		if (lable != null) {
			lableView.setText(lable);
		}
		EditText inputView = (EditText) layout.findViewById(R.id.secend);
		inputView.setHint(hint);
		if (content != null) {
			inputView.setText(content);
		}
		inputView.addTextChangedListener(new TextWatcher() {
			
			@Override
			public void onTextChanged(CharSequence s, int start, int before, int count) {
				// TODO Auto-generated method stub
				
			}
			
			@Override
			public void beforeTextChanged(CharSequence s, int start, int count,
					int after) {
				// TODO Auto-generated method stub
				
			}
			
			@Override
			public void afterTextChanged(Editable s) {
				switchToEditMode();
			}
		});
	}

}
