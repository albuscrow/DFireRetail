package com.dfire.retail.app.manage.activity.retailmanager;

import java.util.ArrayList;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.drawable.BitmapDrawable;
import android.os.Bundle;
import android.provider.MediaStore;
import android.util.Log;
import android.view.Gravity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup.LayoutParams;
import android.view.Window;
import android.view.WindowManager;
import android.widget.ListView;
import android.widget.PopupWindow;

import com.dfire.retail.app.common.item.ItemEditList;
import com.dfire.retail.app.common.item.ItemEditRadio;
import com.dfire.retail.app.common.item.ItemEditText;
import com.dfire.retail.app.common.item.ItemTextView;
import com.dfire.retail.app.manage.R;
import com.dfire.retail.app.manage.activity.TitleActivity;
import com.dfire.retail.app.manage.adapter.EmployeeInfoDetailAdapter;
import com.dfire.retail.app.manage.adapter.EmployeeInfoDetailItem;
import com.dfire.retail.app.manage.adapter.EmployeePFMAdapter;
import com.dfire.retail.app.manage.adapter.EmployeePFMItem;
import com.dfire.retail.app.manage.util.Utility;

/**
 * 店家信息
 * @author Administrator
 *
 */
public class RetailInfoActivity extends  TitleActivity{
	
	ArrayList<EmployeeInfoDetailItem> mList;
	
	ArrayList<EmployeePFMItem> mSubStoreList;
	private EmployeePFMAdapter mSubAdapter;
	private ListView mSubStoreListView;
	private View mView = null;
	ListView mMenuList = null;
	private LayoutInflater mLayoutInflater;
	
	//店家区域列表
	private ItemEditList mEL_RetailArea;
	
	//门店开始营业时间
	private ItemEditList mEL_RetailStartTime;
	
	//门店结束营业时间
	private ItemEditList mEL_RetailEndTime;
	
	//门店名称
	private ItemEditText mED_RetailName;
	
	//门店联系电话
	private ItemEditText mED_RetailPhone;
	
	//门店微信
	private ItemEditText mED_RetailWeixin;
	
	//门店详细地址
	private ItemEditText mED_RetailAdress;
	
	//店家编号
	private ItemTextView mTX_RetailNO;

	
	private final static int ADD_PHOTO = 1;
	private final static int FROM_CAPTURE = 2;
	private final static int FROM_ABLUM = 3;
	private final static int ADD_CANCEL = 4;
	
	
	
	//add the new window
	WindowManager mWindowManager;
	Window mWindow ;
    private PopupWindow mPw;
		
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		
		setContentView(R.layout.activity_retail_info);
		
		setTitle("店家信息");
		change2saveMode();
		setRightBtn(R.drawable.save);
		
		//分店信息
		
		mSubStoreListView = (ListView)findViewById(R.id.sub_store_info_detail_list);
		mSubStoreList = new ArrayList<EmployeePFMItem>();
		mSubAdapter = new EmployeePFMAdapter(RetailInfoActivity.this, mSubStoreList);		
		mSubStoreListView.setAdapter(mSubAdapter);		
		Utility.setListViewHeightBasedOnChildren(mSubStoreListView);
		
		//初始化门店信息
		
	}
	
	/**
	 * 查找控件ID信息
	 * 
	 */
	private void findView(){
		mEL_RetailArea = (ItemEditList)findViewById(R.id.retailArea);
		mEL_RetailStartTime = (ItemEditList)findViewById(R.id.retailStartTime);
		
		//txtName=(ItemEditText)findViewById(R.id.txtName);
		//rdoOn=(ItemEditRadio)findViewById(R.id.rdoOn);
		//lblShop=(ItemTextView)findViewById(R.id.lblShop);
	}
	
	
  private void initRetailInfo(){
	    	  
	  mSubStoreList.add(new EmployeePFMItem(null, null, "二维或杭州公司", "店家代码：0100"));
	  mSubStoreList.add(new EmployeePFMItem(null, null, "二维或杭州公司", "店家代码：0101"));
  }
  
  protected void onActivityResult(int requestCode, int resultCode, Intent data) {  
  	if (1 == requestCode) {
  		// 系统相机返回处理         
  		if (resultCode == Activity.RESULT_OK) {
  			Bitmap cameraBitmap = (Bitmap) data.getExtras().get("data");  
  			// 处理图像 	
  			//wallpaper.setImageBitmap(cameraBitmap);
  			}         
  		}
  	super.onActivityResult(requestCode, resultCode, data);
  		
  } 
  
  public void addClick(View v){
		Log.i("kyolee","tag = "+Integer.parseInt(String.valueOf(v.getTag())));
		switch (Integer.parseInt(String.valueOf(v.getTag()))) {	
		
		case ADD_PHOTO:
			showAddMenu();
			break;
		case FROM_CAPTURE: 
	        Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
		    startActivityForResult(intent, 1);
			break;
		case FROM_ABLUM:
			break;
		case ADD_CANCEL:
			if(mPw!=null && mPw.isShowing())
			{
				mPw.dismiss();
			}
			break;
			
		}
			
  }
  
  private void showAddMenu(){
//	  mWindowManager =  getWindowManager();	
//	  if(mMenuList == null)
//		  mMenuList = new ListView(StoreInfoActivity.this);	  
//		mWindow = getWindow();		
//		WindowManager.LayoutParams lp = mWindow.getAttributes(); 	
//		//mWindow.setType(WindowManager.LayoutParams.TYPE_SYSTEM_OVERLAY);
//		
//		Display display = mWindowManager.getDefaultDisplay();		 
//	    lp.width = (int) (display.getWidth()-20);
//	    lp.height = LayoutParams.WRAP_CONTENT;
	  		
	      LayoutInflater inflater = (LayoutInflater)this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
	  	  mView = inflater.inflate(R.layout.store_info_add_menu,null, false);	
	      mPw =new PopupWindow(mView,LayoutParams.MATCH_PARENT, LayoutParams.WRAP_CONTENT,true);
//	      getWindow().setAttributes(lp);
	      mPw.setBackgroundDrawable(new BitmapDrawable());// 响应返回键必须的语句。
	      mPw.showAtLocation(getWindow().getDecorView(), Gravity.BOTTOM | Gravity.CENTER_HORIZONTAL, 10, 10);
	    
//	    mWindow.setAttributes(lp);
	    	    
//	    lp.gravity=Gravity.BOTTOM|Gravity.CENTER_HORIZONTAL;
	    
	    //mMenuList.setBackgroundColor(getResources().getColor(R.color.white));
	    
//	    mView = View.inflate(StoreInfoActivity.this,R.layout.store_info_add_menu,null);
//	    mWindow.setBackgroundDrawableResource(getResources().getColor(R.color.transparent));
//	    mWindow.addContentView(mView, lp);
//	    String Routes[]={"第1条","第2条","第3条","第4条","第5条"};
//
//        ArrayList<String> data = new ArrayList<String>();
//                for (int i = 0; i < 5; i++) {
//                        data.add(Routes[i]);
//                }
//	    mMenuList.setAdapter(new ArrayAdapter<String>(StoreInfoActivity.this,
//	    		android.R.layout.simple_list_item_1,data));
//	    mWindowManager.addView(mView, lp);
	    
	    //mView.setFocusable(true);
	    //mView.setFocusableInTouchMode(true);
	    mView.requestFocus();
  }


  
}


